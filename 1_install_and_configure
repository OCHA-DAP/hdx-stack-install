# copyleft 2015 teodorescu.serban@gmail.com

# update the system and install minimal required stuff
echo "Update the host system. Please wait."
apt-get -qq update;
apt-get -qq upgrade;
echo "Done."
echo "Install a few dependencies."
apt-get -qq -y install tmux mc gettext-base git apparmor
echo "Done."

echo "Setting host's smtp to listen only to localhost and ipv4."
postconf -e inet_interfaces=127.0.0.1
postconf -e inet_protocols=ipv4
invoke-rc.d postfix restart
echo "Done."

# install latest pip
wget https://bootstrap.pypa.io/get-pip.py
python get-pip.py

# install latest docker
echo "Installing docker. Please wait."
curl -sSL https://get.docker.com/ubuntu/ | sh >/dev/null
echo "Done."
# customize the docker aufs location
echo "Change docker aufs location to /data/docker"
mkdir -p /data
echo "DOCKER_OPTS=\"-g /data/docker\"" >> /etc/default/docker
restart docker
echo "Done"

# install docker tools
echo "Install docker tools. Please wait."
curl --fail -sL -O \
    https://github.com/phusion/baseimage-docker/archive/master.tar.gz
tar xzf master.tar.gz
./baseimage-docker-master/install-tools.sh > /dev/null
rm -rf master.tar.gz
rm -rf baseimage-docker-master
echo "Done."

# install docker compose
curl -L https://github.com/docker/compose/releases/download/1.2.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose


echo "Install docker compose bash completion."
curl -sL https://raw.githubusercontent.com/docker/compose/1.2.0/contrib/completion/bash/docker-compose > /etc/bash_completion.d/docker-compose
echo "Done."
