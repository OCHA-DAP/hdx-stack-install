
echo "Creating required directories if you were so lazy to NOT install nginx on the host yet..."
mkdir -p /etc/nginx/sites-available /etc/nginx/sites-enabled
echo "Removing default vhost link."
rm -f /etc/nginx/sites-enabled/default > /dev/null
echo "Constructing password file to restrict access."
echo ${HDX_NGINX_PASS} > /etc/nginx/${HDX_TYPE}_datapass
echo "Creating the restricted include file."
envsubst < hdx-install/nginx_restricted_conf > /etc/nginx/sites-available/${HDX_TYPE}-restricted.conf
echo "Copy the bypass include file."
envsubst < hdx-install/nginx_bypass_conf     > /etc/nginx/sites-available/${HDX_TYPE}-bypass-location.conf
echo "Copying hdx vhost file."
envsubst < hdx-install/nginx_conf            > /etc/nginx/sites-available/${HDX_TYPE}
echo "Activating it."
ln -sf /etc/nginx/sites-available/${HDX_TYPE} /etc/nginx/sites-enabled/${HDX_TYPE}
echo "Reloading nginx."
invoke-rc.d nginx reload
echo "Done."
